<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crypto Kings TestBed v9.9.26-live</title>
  <style>
    body {margin:0;font-family:system-ui,Arial,sans-serif;background:#f7f7f9;color:#111;}
    header {background:#fff;border-bottom:1px solid #ddd;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;}
    header h1 {margin:0;font-size:18px;}
    nav {display:flex;gap:16px;}
    nav a {text-decoration:none;color:#333;font-weight:600;}
    .wrap {max-width:1100px;margin:0 auto;padding:20px;}
    button {padding:10px 16px;border:0;border-radius:6px;background:#4a67f5;color:#fff;font-weight:600;cursor:pointer;}
    button:disabled{background:#aaa;}
    .log {background:#111;color:#0f0;font-family:monospace;font-size:13px;padding:10px;height:200px;overflow:auto;white-space:pre-line;border-radius:6px;}
    table {width:100%;border-collapse:collapse;margin-top:20px;}
    th,td {padding:8px;border-bottom:1px solid #ddd;font-size:14px;text-align:left;}
    th {background:#eee;}
    tr.good {background:#e6ffed;}
    tr.bad {background:#ffecec;}
    footer {background:#f0f0f0;border-top:1px solid #ddd;padding:20px;margin-top:40px;text-align:center;font-size:13px;color:#555;}
    @media(max-width:720px){nav{display:none;} header{flex-direction:column;align-items:flex-start;}}
  </style>
</head>
<body>
  <header>
    <h1>Crypto Kings v9.9.26-live</h1>
    <nav>
      <a href="#">Home</a>
      <a href="#">Who are we</a>
      <a href="#">What we do</a>
      <a href="#">Connect with us</a>
    </nav>
  </header>
  <div class="wrap">
    <div>
      <label>Loan Amount (USDC):</label>
      <input id="loan" type="number" value="10000" min="1000" max="100000">
      <button id="scanBtn">Scan</button>
      <button id="selectProfitable">Select All Profitable</button>
    </div>
    <div class="log" id="log"></div>
    <table id="results">
      <thead>
        <tr>
          <th>Token</th>
          <th>Buy DEX</th>
          <th>Sell DEX</th>
          <th>Spread %</th>
          <th>USDC Back</th>
          <th>Net P/L</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <footer>
    © 2025 Crypto Kings Limited — All rights reserved.
  </footer>

<script>
const ALCHEMY_URL = "https://arb-mainnet.g.alchemy.com/v2/h4YaGX9cc_WywAx5cvsez"; 
const TOKENS = ["WETH","USDC","USDT","DAI","ARB","LINK","GMX","AAVE","WBTC","RDNT","PENDLE","FRAX","CRV","BAL","UNI","wstETH","SNX","COMP","YFI","GRT","STG","LQTY","RPL","MKR","ENS","CVX","FXS","SUSHI","LUSD","MAGIC","BADGER","DODO","BNT","OP"];

const logEl=document.getElementById("log");
function log(msg){logEl.textContent+="["+new Date().toLocaleTimeString()+"] "+msg+"\\n";logEl.scrollTop=logEl.scrollHeight;}

async function fetchDexQuotes(symbol){
  try{
    const res=await fetch(`https://api.dexscreener.com/latest/dex/tokens/${symbol}`);
    if(!res.ok) return null;
    return await res.json();
  }catch(e){return null;}
}

function calcRoute(pairs,loan){
  if(!pairs||!pairs.length)return null;
  let best=null;
  for(let buy of pairs){
    for(let sell of pairs){
      if(buy===sell)continue;
      const spread=(sell.priceUsd-buy.priceUsd)/buy.priceUsd*100;
      if(spread>0&&spread<50){
        const usdcBack=loan*(sell.priceUsd/buy.priceUsd);
        const pl=usdcBack-loan-(loan*0.009);
        if(pl>0){
          if(!best||pl>best.pl)best={buy,sell,spread,usdcBack,pl};
        }
      }
    }
  }
  return best;
}

async function scan(){
  const loan=parseFloat(document.getElementById("loan").value)||10000;
  document.querySelector("#results tbody").innerHTML="";
  log("CLICK Scan; tokens="+TOKENS.length+"; loan="+loan);
  for(const t of TOKENS){
    const data=await fetchDexQuotes(t);
    if(!data||!data.pairs){log(t+": no pools");continue;}
    const pairs=data.pairs.filter(p=>p.chainId==="arbitrum");
    if(!pairs.length){log(t+": no Arbitrum pools");continue;}
    const best=calcRoute(pairs,loan);
    if(best){
      log(t+": profitable "+best.spread.toFixed(2)+"%");
      const row=document.createElement("tr");
      row.classList.add("good");
      row.innerHTML=`<td>${t}</td><td>${best.buy.dexId}</td><td>${best.sell.dexId}</td><td>${best.spread.toFixed(2)}%</td><td>${best.usdcBack.toFixed(2)}</td><td>${best.pl.toFixed(2)}</td>`;
      document.querySelector("#results tbody").appendChild(row);
    }else{
      log(t+": no profitable route");
      const row=document.createElement("tr");
      row.classList.add("bad");
      row.innerHTML=`<td>${t}</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td>`;
      document.querySelector("#results tbody").appendChild(row);
    }
  }
}
document.getElementById("scanBtn").onclick=scan;
document.getElementById("selectProfitable").onclick=()=>{
  [...document.querySelectorAll("tr.good")].forEach(r=>r.style.outline="2px solid #0a0");
};
</script>
</body>
</html>
